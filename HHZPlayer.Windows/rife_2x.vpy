import vapoursynth as vs
core = vs.core
clip = video_in

# åŠ è½½ RIFE æ’ä»¶
core.std.LoadPlugin(r"rife\librife_windows_x86-64.dll")
print(f"clipåˆ†è¾¨ç‡ä¸º:{clip.width}x{clip.height}!")
# å¦‚æœåˆ†è¾¨ç‡ <= 1080pï¼šç›´æ¥æ’å¸§
if clip.width <= 1920 and clip.height <= 1080:
    print(f"ğŸ”¹ æºåˆ†è¾¨ç‡ {clip.width}x{clip.height}ï¼Œä½¿ç”¨ v4.6 æ¨¡å‹ç›´æ¥è¡¥å¸§")
    # è½¬ RGBS
    clip = core.resize.Bicubic(clip, format=vs.RGBS, matrix_in_s='709')
    # RIFE æ’å¸§
    clip = core.rife.RIFE(
        clip,
        model_path=r"rife\models\rife-v4.6",
        factor_num=2        
    )
    # è½¬å› YUV è¾“å‡º
    clip = core.resize.Bicubic(clip, format=vs.YUV444P10, matrix_s='709')

# å¦‚æœåˆ†è¾¨ç‡ > 1080pï¼šå…ˆç¼©å°å†æ”¾å¤§
else:
    print(f"ğŸ”¹ æºåˆ†è¾¨ç‡ {clip.width}x{clip.height}ï¼Œé™é‡‡æ ·åˆ° 1280p åä½¿ç”¨ v4.6 æ¨¡å‹è¡¥å¸§")
    # è®¡ç®—ç­‰æ¯”ç¼©æ”¾
    target_h = int(clip.height * 1280 / clip.width + 0.5)
    # ç¼©æ”¾åˆ° 1280 å®½
    clip = core.resize.Bicubic(clip, width=1280, height=target_h, format=vs.RGBS, matrix_in_s='709')
    # RIFE æ’å¸§ï¼ˆè½»é‡æ¨¡å‹ï¼‰
    clip = core.rife.RIFE(
        clip,
        model_path=r"rife\models\rife-v4.6",
        factor_num=2
    )
    # å‡å›åŸåˆ†è¾¨ç‡
    clip = core.resize.Bicubic(clip, width=clip.width, height=clip.height, format=vs.YUV444P10, matrix_s='709')

# è¾“å‡ºç»“æœ
clip.set_output()
